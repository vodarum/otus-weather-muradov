(()=>{"use strict";class e{constructor(e,t){this.latitude=e,this.longitude=t}}class t{constructor(t){this.city=t?.name,this.temp=t?.main.temp,this.icon=t?.weather[0].icon,this.coord=t?new e(t.coord.lat,t.coord.lon):new e}}class a extends e{constructor(e){e?super(+e.latitude,+e.longitude):super(),this.country=e?.country,this.city=e?.city}}const n=new class{LOCATION_URL="https://get.geojs.io/v1/ip/geo.json";WEATHER_URL="https://api.openweathermap.org/data/2.5/weather";WEATHER_API_KEY="1cf44d73b10a208539e8d4267c92ac9f";async getCurrentLocationInfo(){let e=new a;try{const t=await fetch(this.LOCATION_URL);if(!t.ok)throw new Error(`HTTP response status ${t.status}`);const n=await t.json();e=new a(n)}catch(e){console.error(`Error in API.getCurrentLocationInfo: ${e instanceof Error?e.message:e}`)}return e}async getWeatherInfoByLocationCoord(e,a){let n=new t;try{const r=`${this.WEATHER_URL}?lat=${e}&lon=${a}&appid=${this.WEATHER_API_KEY}&units=metric&lang=ru`,o=await fetch(r);if(!o.ok)throw new Error(`HTTP response status ${o.status}`);const s=await o.json();n=new t(s)}catch(e){console.error(`Error in API.getWeatherInfoByLocationCoord: ${e instanceof Error?e.message:e}`)}return n}async getWeatherInfoByLocationName(e){let a=new t;if(e)try{const n=`${this.WEATHER_URL}?q=${e}&appid=${this.WEATHER_API_KEY}&units=metric&lang=ru`,r=await fetch(n);if(!r.ok)throw new Error(`HTTP response status ${r.status}`);const o=await r.json();a=new t(o)}catch(e){console.error(`Error in API.getWeatherInfoByLocationName: ${e instanceof Error?e.message:e}`)}return a}},r=new class{addStaticMapOnScreen(e){const t=document.getElementById("weather-map"),a=this.createMarkupElement("img",{src:`https://static-maps.yandex.ru/1.x/?ll=${e.longitude},${e.latitude}&size=650,350&z=12&l=map`});t.innerHTML="",t.append(a)}addWeatherHistoryOnScreen(){const e=document.getElementById("weather-history");e.innerHTML="";const t=JSON.parse(localStorage.getItem("weatherHistory")??"[]");for(let a=0,n=t.length;a<n;a++){const n=this.createMarkupElement("span",{class:"weather-history__item","data-wh-item-id":`${a}`});n.innerHTML=t[a].city,e.append(n)}}addWeatherMainOnScreen(e){const t=document.getElementById("weather-main"),a=this.createMarkupElement("img",{src:`http://openweathermap.org/img/w/${e.icon}.png`,class:"weather-main__img"}),n=this.createMarkupElement("div",{class:"weather-main__text"}),r=document.createElement("p");r.innerHTML=`Город: ${e.city}`;const o=document.createElement("p");o.innerHTML=`Температура: ${e.temp}&#176;С`,t.innerHTML="",n.append(r,o),t.append(a,n)}createInitialMarkup(){const e=this.createMarkupElement("main",{class:"main"}),t=this.createMarkupElement("section",{class:"section"}),a=this.createMarkupElement("h1",{class:"title"});a.innerHTML="Weather App";const n=this.createMarkupElement("form",{class:"form",id:"form"}),r=this.createMarkupElement("input",{type:"text",placeholder:"Enter an address or city name",class:"input",id:"input"}),o=this.createMarkupElement("button",{type:"submit",class:"btn",id:"btn"});o.innerHTML="Enter";const s=this.createMarkupElement("div",{class:"weather-info",id:"weather-info"}),i=this.createMarkupElement("div",{class:"weather-info__item weather-main",id:"weather-main"}),c=this.createMarkupElement("div",{class:"weather-info__item weather-map",id:"weather-map"}),h=this.createMarkupElement("div",{class:"weather-info__item weather-history",id:"weather-history"});s.append(i,c,h),n.append(r,o),t.append(a,n,s),e.append(t),document.body.append(e)}createMarkupElement(e,t){const a=document.createElement(e);return Object.entries(t).forEach((([e,t])=>{a.setAttribute(e,t)})),a}removeMarkup(){document.body.innerHTML=""}},o=e=>null!=e,s=new class{saveWeatherInfo(e){const t=JSON.parse(localStorage.getItem("weatherHistory")??"[]").filter((t=>t.city!==e.city));t.unshift(e),localStorage.setItem("weatherHistory",JSON.stringify(t.slice(0,10)))}validateCoord(t){return t instanceof e&&(n=t.latitude,o(n)&&n<=90&&n>=-90)&&(a=t.longitude,o(a)&&a<=180&&a>=-180);var a,n}validateWeatherInfo(e){return e instanceof t&&o(e.city)&&o(e.temp)&&"number"==typeof e.temp&&this.validateCoord(e.coord)}};(new class{constructor(){this.mainWeatherInfo=new t}init(){r.createInitialMarkup(),document.getElementById("form").addEventListener("submit",(e=>{e.preventDefault(),this.search()})),document.getElementById("weather-history").addEventListener("click",(e=>{const t=e.target.closest(".weather-history__item");t&&this.selectItemFromWeatherHistory(t.dataset.whItemId)})),n.getCurrentLocationInfo().then((e=>n.getWeatherInfoByLocationCoord(e.latitude,e.longitude))).then((e=>this.saveStateAndRefresh(e))).catch((e=>console.error(e)))}async saveStateAndRefresh(e){s.validateWeatherInfo(e)&&(s.saveWeatherInfo(e),this.mainWeatherInfo=e,r.addWeatherMainOnScreen(this.mainWeatherInfo),r.addStaticMapOnScreen(this.mainWeatherInfo.coord),r.addWeatherHistoryOnScreen())}async selectItemFromWeatherHistory(e){if(!o(e))return;const t=JSON.parse(localStorage.getItem("weatherHistory")??"[]"),a=await n.getWeatherInfoByLocationCoord(t[+e].coord.latitude,t[+e].coord.longitude);await this.saveStateAndRefresh(a)}async search(){const e=document.getElementById("input");try{const t=await n.getWeatherInfoByLocationName(e.value);await this.saveStateAndRefresh(t)}catch(e){console.error(`Error in Main.search: ${e}`)}finally{e.value=""}}}).init()})();
//# sourceMappingURL=main.js.map