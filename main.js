(()=>{"use strict";class e{latitude=null;longitude=null;constructor(e,t){this.latitude=e,this.longitude=t}}class t{city=null;temp=null;icon=null;coord=new e;constructor(t){this.city=t?.name??null,this.temp=t?.main.temp??null,this.icon=t?.weather[0].icon??null,this.coord=new e(t?.coord.lat??null,t?.coord.lon??null)}}class n extends e{country=null;city=null;constructor(e){super(e?.latitude??null,e?.longitude??null),this.country=e?.country??null,this.city=e?.city??null}}const a=new class{LOCATION_URL="https://get.geojs.io/v1/ip/geo.json";async getCurrentLocationInfo(){let e=new n;try{const t=await fetch(this.LOCATION_URL);if(!t.ok)throw new Error(`HTTP response status ${t.status}`);const a=await t.json();e=new n(a)}catch(e){console.error(`Error in Location.getCurrentLocationInfo: ${e.message}`)}return e}},r=new class{addStaticMapOnScreen(e){const t=document.getElementById("weather-map"),n=this.createMarkupElement("img",{src:`https://static-maps.yandex.ru/1.x/?ll=${e.longitude},${e.latitude}&size=650,350&z=12&l=map`});t.innerHTML="",t.append(n)}addWeatherHistoryOnScreen(){const e=document.getElementById("weather-history");e.innerHTML="";const t=JSON.parse(localStorage.getItem("weatherHistory")??"[]");for(let n=0,a=t.length;n<a;n++){const a=this.createMarkupElement("span",{class:"weather-history__item","data-wh-item-id":n});a.innerHTML=t[n].city,e.append(a)}}addWeatherMainOnScreen(e){const t=document.getElementById("weather-main"),n=this.createMarkupElement("img",{src:`http://openweathermap.org/img/w/${e.icon}.png`,class:"weather-main__img"}),a=this.createMarkupElement("div",{class:"weather-main__text"}),r=document.createElement("p");r.innerHTML=`Город: ${e.city}`;const i=document.createElement("p");i.innerHTML=`Температура: ${e.temp}&#176;С`,t.innerHTML="",a.append(r,i),t.append(n,a)}createInitialMarkup(){const e=this.createMarkupElement("main",{class:"main"}),t=this.createMarkupElement("section",{class:"section"}),n=this.createMarkupElement("h1",{class:"title"});n.innerHTML="Weather App";const a=this.createMarkupElement("input",{type:"text",placeholder:"Enter an address or city name",class:"input",id:"input"}),r=this.createMarkupElement("button",{type:"button",class:"btn",id:"btn"});r.innerHTML="Enter";const i=this.createMarkupElement("div",{class:"weather-info",id:"weather-info"}),o=this.createMarkupElement("div",{class:"weather-info__item weather-main",id:"weather-main"}),s=this.createMarkupElement("div",{class:"weather-info__item weather-map",id:"weather-map"}),c=this.createMarkupElement("div",{class:"weather-info__item weather-history",id:"weather-history"});i.append(o,s,c),t.append(n,a,r,i),e.append(t),document.body.append(e)}createMarkupElement(e,t){const n=document.createElement(e);return Object.entries(t).forEach((([e,t])=>{n.setAttribute(e,t)})),n}removeMarkup(){document.body.innerHTML=""}},i=new class{isDefined(e){return null!=e}},o=new class{WEATHER_URL="https://api.openweathermap.org";WEATHER_API_KEY="1cf44d73b10a208539e8d4267c92ac9f";async getWeatherInfoByLocationCoord(e,n){let a=new t;try{const r=`${this.WEATHER_URL}/data/2.5/weather?lat=${e}&lon=${n}&appid=${this.WEATHER_API_KEY}&units=metric&lang=ru`,i=await fetch(r);if(!i.ok)throw new Error(`HTTP response status ${i.status}`);const o=await i.json();a=new t(o)}catch(e){console.error(`Error in WeatherInfo.getWeatherInfoByLocationCoord: ${e.message}`)}return a}async getWeatherInfoByLocationName(e){let n=new t;if(e)try{const t=`${this.WEATHER_URL}/geo/1.0/direct?q=${e}&appid=${this.WEATHER_API_KEY}`,a=await fetch(t);if(!a.ok)throw new Error(`HTTP response status ${a.status}`);const r=await a.json();n=await this.getWeatherInfoByLocationCoord(r[0].lat,r[0].lon)}catch(e){console.error(`Error in WeatherInfo.getWeatherInfoByLocationName: ${e.message}`)}return n}saveWeatherInfo(e){const t=JSON.parse(localStorage.getItem("weatherHistory")??"[]").filter((t=>t.city!==e.city));t.unshift(e),localStorage.setItem("weatherHistory",JSON.stringify(t.slice(0,10)))}validateCoord(t){return t instanceof e&&(a=t.latitude,i.isDefined(a)&&+a<=90&&+a>=-90)&&(n=t.longitude,i.isDefined(n)&&+n<=180&&+n>=-180);var n,a}validateWeatherInfo(e){return e instanceof t&&i.isDefined(e.city)&&i.isDefined(e.temp)&&"number"==typeof e.temp&&this.validateCoord(e.coord)}};(new class{constructor(){this.mainWeatherInfo=new t}init(){r.createInitialMarkup(),document.getElementById("btn").addEventListener("click",(()=>this.search())),document.getElementById("weather-history").addEventListener("click",(e=>{const t=e.target.closest(".weather-history__item");t&&this.selectItemFromWeatherHistory(t.dataset.whItemId)})),a.getCurrentLocationInfo().then((e=>o.getWeatherInfoByLocationCoord(e.latitude,e.longitude))).then((e=>this.refresh(e))).catch((e=>console.error(e)))}async savePrevStateAndRefresh(e){o.validateWeatherInfo(e)&&(o.saveWeatherInfo(this.mainWeatherInfo),this.refresh(e))}async selectItemFromWeatherHistory(e){if(!i.isDefined(e))return;const t=JSON.parse(localStorage.getItem("weatherHistory")??"[]"),n=await o.getWeatherInfoByLocationCoord(t[+e].coord.latitude,t[+e].coord.longitude);await this.savePrevStateAndRefresh(n)}refresh(e){this.mainWeatherInfo=e,r.addWeatherMainOnScreen(this.mainWeatherInfo),r.addStaticMapOnScreen(this.mainWeatherInfo.coord),r.addWeatherHistoryOnScreen()}async search(){const e=document.getElementById("input");try{const t=await o.getWeatherInfoByLocationName(e.value);await this.savePrevStateAndRefresh(t)}catch(e){console.error(`Error in Main.search: ${e}`)}finally{e.value=""}}}).init()})();
//# sourceMappingURL=main.js.map